#
# Marlin Firmware
# config.ini - Options to apply before the build
#
# This file was generated from Configuration.h and Configuration_adv.h
# Author: Mahmoud Salah, Mdluex i3
#

[config:base]
ini_use_config = base

#===========================================================================
#============================= Getting Started =============================
#===========================================================================

# Author info
string_config_h_author = "(Mahmoud Salah, Mdluex i3)"

# Custom Machine Name
custom_machine_name = "Mdluex i3"

#===========================================================================
#============================= Machine Settings ============================
#===========================================================================

# Motherboard
motherboard = BOARD_RAMPS_14_EFB

# Serial Communication
serial_port = 0
baudrate = 250000

# Stepper Drivers
x_driver_type = DRV8825
y_driver_type = DRV8825
z_driver_type = DRV8825
e0_driver_type = DRV8825

#===========================================================================
#============================= Extruder Settings ===========================
#===========================================================================

extruders = 1
default_nominal_filament_dia = 1.75

#===========================================================================
#============================= Temperature Sensors =========================
#===========================================================================

# Hotend Temperature Sensor
temp_sensor_0 = 1
temp_sensor_1 = 0
temp_sensor_2 = 0
temp_sensor_3 = 0
temp_sensor_4 = 0
temp_sensor_5 = 0
temp_sensor_6 = 0
temp_sensor_7 = 0

# Bed Temperature Sensor
temp_sensor_bed = 1

# Other Temperature Sensors
temp_sensor_probe = 0
temp_sensor_chamber = 0
temp_sensor_cooler = 0
temp_sensor_board = 0
temp_sensor_soc = 0
temp_sensor_redundant = 0

# Temperature Residency
temp_residency_time = 10
temp_window = 1
temp_hysteresis = 3

# Bed Temperature Residency
temp_bed_residency_time = 10
temp_bed_window = 1
temp_bed_hysteresis = 3

# Temperature Limits - Hotend
heater_0_mintemp = 5
heater_1_mintemp = 5
heater_2_mintemp = 5
heater_3_mintemp = 5
heater_4_mintemp = 5
heater_5_mintemp = 5
heater_6_mintemp = 5
heater_7_mintemp = 5

heater_0_maxtemp = 300
heater_1_maxtemp = 275
heater_2_maxtemp = 275
heater_3_maxtemp = 275
heater_4_maxtemp = 275
heater_5_maxtemp = 275
heater_6_maxtemp = 275
heater_7_maxtemp = 275

# Temperature Limits - Bed
bed_mintemp = 5
bed_maxtemp = 150

# Temperature Limits - Chamber
chamber_mintemp = 5
chamber_maxtemp = 60

# Thermal Overshoot
hotend_overshoot = 15
bed_overshoot = 10
cooler_overshoot = 2

#===========================================================================
#============================= PID Settings ================================
#===========================================================================

# PID Temperature Control
pidtemp = on
pid_max = 255
pid_k1 = 0.95

# PID Values
default_kp = 22.20
default_ki = 1.08
default_kd = 114.00

# Bed PID (disabled, using bang-bang)
#pidtempbed = off

# PID Functional Range
pid_functional_range = 20

#===========================================================================
#============================= Bed Power ===================================
#===========================================================================

max_bed_power = 255
max_chamber_power = 255

#===========================================================================
#============================= Thermal Protection ==========================
#===========================================================================

thermal_protection_hotends = on
thermal_protection_bed = on
thermal_protection_chamber = on
thermal_protection_cooler = on

# Thermal Protection Parameters (from Configuration_adv.h)
thermal_protection_period = 40
thermal_protection_hysteresis = 4

thermal_protection_bed_period = 20
thermal_protection_bed_hysteresis = 2

# Watch Temperature Settings
watch_temp_period = 40
watch_temp_increase = 2

watch_bed_temp_period = 60
watch_bed_temp_increase = 2

# Thermocouple Settings
thermocouple_max_errors = 15

# Bed Check Interval (bang-bang mode)
bed_check_interval = 5000

#===========================================================================
#============================= Endstop Settings ============================
#===========================================================================

endstoppullups = on

# Endstop Hit States
x_min_endstop_hit_state = LOW
x_max_endstop_hit_state = LOW
y_min_endstop_hit_state = LOW
y_max_endstop_hit_state = LOW
z_min_endstop_hit_state = LOW
z_max_endstop_hit_state = LOW
z_min_probe_endstop_hit_state = HIGH

# ENDSTOP INVERTING SETTINGS (Added by User Request)
x_min_endstop_inverting = true
y_min_endstop_inverting = true
z_min_endstop_inverting = true
z_min_probe_endstop_inverting = true
# Other inverting settings (default false/custom)
x_max_endstop_inverting = false
y_max_endstop_inverting = false
z_max_endstop_inverting = false
i_min_endstop_inverting = false
j_min_endstop_inverting = false
k_min_endstop_inverting = false
u_min_endstop_inverting = false
v_min_endstop_inverting = false
w_min_endstop_inverting = false
i_max_endstop_inverting = false
j_max_endstop_inverting = false
k_max_endstop_inverting = false
u_max_endstop_inverting = false
v_max_endstop_inverting = false
w_max_endstop_inverting = false

# Standard RAMPS 1.4 Pin Definitions
x_min_pin = 3
y_min_pin = 14
z_min_pin = 18



#===========================================================================
#============================= Movement Settings ===========================
#===========================================================================

# Steps Per Unit
default_axis_steps_per_unit = { 198.07, 76.63, 783.69, 200.00 }

# Enable editable steps per unit
editable_steps_per_unit = on

# Max Feed Rate
default_max_feedrate = { 300, 300, 5, 25 }

# Max Acceleration
default_max_acceleration = { 3000, 3000, 100, 10000 }

# Default Acceleration
default_acceleration = 3000
default_retract_acceleration = 3000
default_travel_acceleration = 3000

# Junction Deviation (Classic Jerk is disabled)
junction_deviation_mm = 0.013
jd_handle_small_segments = on

#===========================================================================
#============================= Z Probe Settings ============================
#===========================================================================

# Z Probe Configuration
z_min_probe_uses_z_min_endstop_pin = on

# Probe Type
fix_mounted_probe = on

# Nozzle to Probe Offset
nozzle_to_probe_offset = { 30.00, 10.00, -4.03 }

# Probing Tool
probing_tool = 0

# Probing Margin
probing_margin = 10

# Probe Feedrates
xy_probe_feedrate = (133*60)
z_probe_feedrate_fast = (4*60)
z_probe_feedrate_slow = (Z_PROBE_FEEDRATE_FAST / 2)

# Z Clearance
z_clearance_deploy_probe = 10
z_clearance_between_probes = 5
z_clearance_multi_probe = 5
z_probe_error_tolerance = 3

z_probe_low_point = -2

#===========================================================================
#============================= Stepper Drivers =============================
#===========================================================================

# DRV8825 timing fix (Required for reliable operation)
minimum_stepper_pulse = 2
maximum_stepper_rate = 250000
adaptive_step_smoothing = on

# Enable Pin States
x_enable_on = LOW
y_enable_on = LOW
z_enable_on = LOW
e_enable_on = LOW

# Stepper Direction
invert_x_dir = false
invert_y_dir = false
invert_z_dir = true

# Extruder Direction
invert_e0_dir = true
invert_e1_dir = false
invert_e2_dir = false
invert_e3_dir = false
invert_e4_dir = false
invert_e5_dir = false
invert_e6_dir = false
invert_e7_dir = false

# Disable Other Extruders
disable_other_extruders = on

#===========================================================================
#============================= Homing Settings =============================
#===========================================================================

# Home Direction
x_home_dir = -1
y_home_dir = -1
z_home_dir = -1

# Homing Feedrate
homing_feedrate_mm_m = { (50*60), (50*60), (4*60) }

# Validate Homing Endstops
validate_homing_endstops = on

# Z Safe Homing - Moves Z probe to center before Z homing
z_safe_homing = on
z_safe_homing_x_point = X_CENTER
z_safe_homing_y_point = Y_CENTER

#===========================================================================
#============================= Bed Size ====================================
#===========================================================================

# Bed Dimensions
x_bed_size = 230
y_bed_size = 210

# Travel Limits
x_min_pos = 0
y_min_pos = 0
z_min_pos = 0
x_max_pos = X_BED_SIZE
y_max_pos = Y_BED_SIZE
z_max_pos = 210

#===========================================================================
#============================= Filament Runout Sensor ======================
#===========================================================================

filament_runout_sensor = on
fil_runout_enabled_default = true
num_runout_sensors = 1
fil_runout_state = HIGH
fil_runout_pullup = on
filament_runout_script = "M600"
advanced_pause_feature = on

#===========================================================================
#============================= Software Endstops ===========================
#===========================================================================

min_software_endstops = on
min_software_endstop_x = on
min_software_endstop_y = on
min_software_endstop_z = on
min_software_endstop_i = on
min_software_endstop_j = on
min_software_endstop_k = on
min_software_endstop_u = on
min_software_endstop_v = on
min_software_endstop_w = on

max_software_endstops = on
max_software_endstop_x = on
max_software_endstop_y = on
max_software_endstop_z = on
max_software_endstop_i = on
max_software_endstop_j = on
max_software_endstop_k = on
max_software_endstop_u = on
max_software_endstop_v = on
max_software_endstop_w = on

#===========================================================================
#============================= Bed Tramming ================================
#===========================================================================

lcd_bed_tramming = on
bed_tramming_inset_lfrb = { 30, 30, 30, 30 }
bed_tramming_height = 0.0
bed_tramming_z_hop = 4.0

#===========================================================================
#============================= Bed Leveling ================================
#===========================================================================

# Auto Bed Leveling
auto_bed_leveling_bilinear = on

# Grid Points
grid_max_points_x = 3
grid_max_points_y = GRID_MAX_POINTS_X

# Leveling Settings
restore_leveling_after_g28 = on
enable_leveling_fade_height = on
default_leveling_fade_height = 10.0

# Segment Leveled Moves
segment_leveled_moves = on
leveled_segment_length = 5.0

#===========================================================================
#============================= EEPROM Settings =============================
#===========================================================================

# Comments moved to separate lines to avoid preprocessor errors
eeprom_settings = on
eeprom_chitchat = on
eeprom_boot_silent = on

#===========================================================================
#============================= Host Communication ==========================
#===========================================================================

host_keepalive_feature = on
default_keepalive_interval = 2
busy_while_heating = on

#===========================================================================
#============================= Preheat Constants ===========================
#===========================================================================

# PLA Preset
preheat_1_label = "PLA"
preheat_1_temp_hotend = 200
preheat_1_temp_bed = 50
preheat_1_temp_chamber = 35
preheat_1_fan_speed = 0

# ABS Preset
preheat_2_label = "ABS"
preheat_2_temp_hotend = 240
preheat_2_temp_bed = 110
preheat_2_temp_chamber = 35
preheat_2_fan_speed = 0

#===========================================================================
#============================= Nozzle Park Feature =========================
#===========================================================================

nozzle_park_feature = on
nozzle_park_point = { (X_MIN_POS + 10), (Y_MAX_POS - 10), 20 }
nozzle_park_move = 0
nozzle_park_z_raise_min = 2
nozzle_park_xy_feedrate = 100
nozzle_park_z_feedrate = 5

#===========================================================================
#============================= Nozzle Clean Feature ========================
#===========================================================================

nozzle_clean_feature = on
nozzle_clean_pattern_line = on
nozzle_clean_pattern_zigzag = on
nozzle_clean_pattern_circle = on
nozzle_clean_default_pattern = 0
nozzle_clean_strokes = 12
nozzle_clean_triangles = 3
nozzle_clean_start_point = { {  30, 30, (Z_MIN_POS + 1) } }
nozzle_clean_end_point = { { 100, 60, (Z_MIN_POS + 1) } }
nozzle_clean_circle_radius = 6.5
nozzle_clean_circle_fn = 10
nozzle_clean_circle_middle = NOZZLE_CLEAN_START_POINT
nozzle_clean_goback = on
nozzle_clean_min_temp = 170

#===========================================================================
#============================= Print Job Timer =============================
#===========================================================================

printjob_timer_autostart = on

#===========================================================================
#============================= Safety Features =============================
#===========================================================================

prevent_cold_extrusion = on
extrude_mintemp = 170

prevent_lengthy_extrude = on
extrude_maxlength = 200

#===========================================================================
#============================= LCD / Controller ============================
#===========================================================================

# LCD Language
lcd_language = en

# Display Character Set
display_charset_hd44780 = JAPANESE

# LCD Info Screen Style
lcd_info_screen_style = 0

# RepRapDiscount Smart Controller
reprap_discount_smart_controller = on

# Fix pin definition errors in Marlin 2.1.3-b3 by pre-defining pins
beeper_pin = 37  # EXP1-01 on RAMPS 1.4
kill_pin = 41    # EXP2-08 on RAMPS 1.4

# Speaker (disabled due to timer conflict with FAN0_PIN)
# speaker = off

# Individual Axis Homing Menu
individual_axis_homing_menu = on

#===========================================================================
#============================= Advanced Settings ===========================
#===========================================================================

# From Configuration_adv.h

# Input Shaping
input_shaping_x = on
input_shaping_y = on
shaping_freq_x = 40.0
shaping_freq_y = 40.0
shaping_zeta_x = 0.15
shaping_zeta_y = 0.15
shaping_menu = on

#===========================================================================
#============================= Z Probe Offset & Babystepping ===============
#===========================================================================

babystepping = on
babystep_zprobe_offset = on
babystep_always_available = on
probe_offset_wizard = on
probe_offset_wizard_start_z = -4.0

# Autotemp
autotemp = on
autotemp_oldweight = 0.98
autotemp_min = 210
autotemp_max = 250
autotemp_factor = 0.1f

# Fan Software PWM (enabled to avoid timer conflict with speaker)
fan_soft_pwm = on

# Software PWM Scale
soft_pwm_scale = 0

# Servo Delay
servo_delay = { 300 }

#===========================================================================
#============================= Minimum Segment Settings ====================
#===========================================================================

min_steps_per_segment = 6
default_minsegmenttime = 20000
default_minimumfeedrate = 0.0
default_mintravelfeedrate = 0.0

#===========================================================================
#============================= Axis Relative Modes =========================
#===========================================================================

axis_relative_modes = { false, false, false, false }

#===========================================================================
#============================= Proportional Font ===========================
#===========================================================================

proportional_font_ratio = 1.0
